<extend name="./Application/Admin/View/Common/base.html"/>
<block name="styles">
    <style>

    </style>
</block>
<block name="content">
    <div class="admin-content-body">
        <div class="am-cf am-padding am-padding-bottom-0">
            <div class="am-fl am-cf">
                <a href="#" onClick="javascript :history.back(1);"><strong
                        class="am-text-primary am-text-lg">领导表率台账</strong></a> /
                <small>
                    <empty name="detail">新增
                        <else/>
                        编辑
                    </empty>
                    台账
                </small>
            </div>
        </div>

        <hr>

        <div class="am-tabs-bd" style='margin:20px;    border: 1px solid #ddd;'>
            <div class="am-tab-panel am-fade am-in am-active">
                <form class="am-form">

                    <empty name="detail">
                        <else/>
                        <input type="hidden" name="id" value="{$detail.id}"></empty>

                    <notempty name="leaders">
                        <div class="am-g am-margin-top">
                            <div class="am-u-sm-4 am-u-md-2 am-text-right" >领导</div>
                            <div class="am-u-sm-8 am-u-md-10">
                                <div class="am-btn-group" data-am-button>
                                    <empty name="detail">
                                        <volist name="leaders" id="item" >
                                            <label class="am-btn am-btn-default am-btn-xs">
                                                <input type="radio" name="leader" value="{$item.uid}" > {$item.realname}
                                            </label>
                                        </volist>
                                    <else/>
                                        <volist name="leaders" id="item">
                                            <label class="am-btn am-btn-default am-btn-xs">
                                                <input type="radio" name="leader" value="{$item.uid}" <if condition="$detail['uid'] == $item['uid']"> checked="true" </if> > {$item.realname}
                                            </label>
                                        </volist>
                                    </empty>

                                </div>
                            </div>
                        </div>
                    </notempty>

                    <div class="am-g am-margin-top">
                        <div class="am-u-sm-4 am-u-md-2 am-text-right">
                            标题
                        </div>
                        <div class="am-u-sm-8 am-u-md-6">
                            <input type="text" class="am-input-sm" name="theme" value="{$detail.theme}">
                        </div>
                        <div class="am-hide-sm-only am-u-md-4 am-form-help">*必填，长度不超过50字符。</div>
                    </div>

                    <div class="am-g am-margin-top">
                        <div class="am-u-sm-4 am-u-md-2 am-text-right">内容</div>
                        <div class="am-u-sm-8 am-u-md-10">
                            <div class="am-btn-group" data-am-button>
                                <empty name="detail">
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="1" checked="true"> 思想汇报
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="2"> 心得体会
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="3"> 活动展现
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="0"> 其它
                                    </label>
                                <else/>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="1" <if condition="$detail.content_type == 1"> checked="true"</if> > 思想汇报
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="2" <if condition="$detail.status == 2"> checked="true"</if> > 心得体会
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="3" <if condition="$detail.status == 3"> checked="true"</if> > 活动展现
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input type="radio" name="content_type" value="0" <if condition="$detail.status == 0"> checked="true"</if> > 其它
                                    </label>
                                </empty>
                            </div>
                        </div>
                    </div>

                    <div class="am-g am-margin-top">
                        <div class="am-u-sm-4 am-u-md-2 am-text-right">分类</div>
                        <div class="am-u-sm-8 am-u-md-10">
                            <div class="am-btn-group" data-am-button>
                                <empty name="detail">
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input class="classify" type="radio" name="classify" value="1" checked="true"> 规定动作
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input class="classify" type="radio" name="classify" value="2"> 自主创新
                                    </label>
                                    <else/>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input class="classify" type="radio" name="classify" value="1" <if condition="$detail.content_type == 1"> checked="true"</if> > 规定动作
                                    </label>
                                    <label class="am-btn am-btn-default am-btn-xs">
                                        <input class="classify" type="radio" name="classify" value="2" <if condition="$detail.status == 2"> checked="true"</if> > 自主创新
                                    </label>
                                </empty>
                            </div>
                        </div>
                    </div>

                    <div class="am-g am-margin-top">
                        <div class="am-u-sm-4 am-u-md-2 am-text-right">
                            主持人
                        </div>
                        <div class="am-u-sm-8 am-u-md-6">
                            <input type="text" class="am-input-sm" name="host" value="{$detail.host}">
                        </div>
                        <div class="am-hide-sm-only am-u-md-4 am-form-help">*必填，长度不超过50字符。</div>
                    </div>

                    <div class="am-g am-margin-top-sm">
                        <div class="am-u-sm-12 am-u-md-2 am-text-right admin-form-text">
                            举办日期
                        </div>
                        <div class="am-u-sm-12 am-u-md-10">
                            <div class="am-input-group am-datepicker-date" data-am-datepicker="{format: 'yyyy-mm-dd'}" style="width: 160px">
                                <input name="attend_time" type="text" value="{$detail.request_finish_date|date='Y-m-d',###}"  class="am-form-field" placeholder="选择日期" data-am-datepicker readonly required >
                                    <span class="am-input-group-btn am-datepicker-add-on">
                                        <button class="am-btn am-btn-default" type="button"><span class="am-icon-calendar"></span></button>
                                    </span>
                            </div>
                        </div>
                    </div>

                    <div class="am-g am-margin-top" id="div-attendance">
                        <div class="am-u-sm-4 am-u-md-2 am-text-right">
                            出席人数
                        </div>
                        <div class="am-u-sm-8 am-u-md-6">
                            <input type="number" class="am-input-sm" name="attendance" value="{$detail.attendance}">
                        </div>
                        <div class="am-hide-sm-only am-u-md-4 am-form-help">*必填。</div>
                    </div>

                    <div class="am-g am-margin-top-sm">
                        <div class="am-u-sm-12 am-u-md-2 am-text-right admin-form-text">
                            出席名单
                        </div>
                        <div class="am-u-sm-12 am-u-md-6">
                            <textarea name="attendee" rows="3">{$detail.attendee}</textarea>
                        </div>
                        <div class="am-hide-sm-only am-u-md-4 am-form-help"></div>
                    </div>

                    <div class="am-g am-margin-top-sm">
                        <div class="am-u-sm-12 am-u-md-2 am-text-right admin-form-text">
                            详细内容
                        </div>
                        <div class="am-u-sm-12 am-u-md-10">
                            <script id="editor" type="text/plain"></script>
                        </div>
                    </div>

                </form>

                <div class="am-margin">
                    <button type="button" class="am-btn am-btn-primary am-btn-xs" id="btn-save" onClick="submit_info();">提交保存</button>
                    <button type="button" class="am-btn am-btn-primary am-btn-xs" id="btn-cancel">放弃保存</button>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="scripts">

    <script type="text/javascript" charset="utf-8" src="__STATICS__/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="__STATICS__/ueditor/ueditor.all.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="__STATICS__/ueditor/lang/zh-cn/zh-cn.js"></script>
    <script src="__STATICS__/datetimepicker/js/amazeui.datetimepicker.min.js"></script>
    <script type="text/javascript" src="__STATICS__/datetimepicker/js/locales/amazeui.datetimepicker.zh-CN.js" charset="UTF-8"></script>
    <script src="__STATICS__/cropper/cropper.min.js"></script>

    <script type="text/javascript">

        var ue = UE.getEditor('editor', {
            // autoHeight: true,
            initialFrameHeight: 400,
//            readonly:true,
            // retainOnlyLabelPasted: true
        });
        ue.ready(function() {
            ue.setContent('{$detail.content}');
        });

        function submit_info() {

            var id = $('input[name="id"]').val();
            var leader = $('input[name="leader"]').val();
            var theme = $('input[name="theme"]').val();
            var contentType = $('input[name="content_type"]:checked').val();
            var classify = $('input[name="classify"]:checked').val();
            var host = $('input[name="host"]').val();
            var attendance = $('input[name="attendance"]').val();
            var attendee = $('textarea[name="attendee"]').val();
            var attendTime = $('input[name="attend_time"]').val();
            var content = ue.getContent();

//            alert("id = " + id + " leader = " + leader + " theme = " + theme + " contentType = " + contentType + " classify = " + classify + " host = " + host + " attendance = " + attendance + " attendee = " + attendee + " attendTime = " + attendTime + " content = " + content)

            $.ajax({
                data: {
                    'id': id,
                    'leader': leader,
                    'theme': theme,
                    'contentType':contentType,
                    'classify': classify,
                    'host': host,
                    'attendance': attendance,
                    'attendee':attendee,
                    'attendTime':attendTime,
                    'content':content,
                },
                type: 'POST',
                dataType: 'json',
                url: '__ROOT__/Admin/StandingBook/ajaxAdd',
                beforeSend: function () {
                    loading();
                },
                success: function (data) {
                    if (data['status'] == 0) {
                        loading_page('__ROOT__/Admin/StandingBook/index_leader');
                    } else {
                        close_loading();
                        alert_modal(data.msg);
                    }
                },
                error: function (data) {
                    close_loading();
                    alert_modal(data.msg);
                }
            })
        };


        /*****************弹窗里面的 js*********************/
            //弹出封面裁剪界面
//        $('#info-cover').click(function () {
//            $('#doc-modal-1').modal();
//        })
//
//        var options = {
//            aspectRatio: 18 / 12,
//            strict: false,
//            preview: '.img-preview',
//            crop: function (e) {
//                $('input[name="avatar_data"]').val(JSON.stringify(e));
//            }
//        };
//
//        var $image =  $('#show_img');
//        var console = window.console || { log: function () {} };
//
//        var URL = window.URL || window.webkitURL;
//        var blobURL;
//        $image.on({
//        }).cropper(options);
//
//        $('#avatarInput').change(function () {
//
//
//            var files = this.files;
//            var file;
//
//            if (!$image.data('cropper')) {
//                return;
//            }
//
//            if (files && files.length) {
//                file = files[0];
//
//                if (/^image\/\w+$/.test(file.type)) {
//                    blobURL = URL.createObjectURL(file);
//                    $image.one('built.cropper', function () {
//
//                        // Revoke when load complete
//                        URL.revokeObjectURL(blobURL);
//                    }).cropper('reset').cropper('replace', blobURL);
////                    $(this).val('');
//                } else {
//                    window.alert('Please choose an image file.');
//                }
//            }
//
//
//
//        })
//        /*******************************************/
//
//
//
//        $('.avatar-save').click(function () {
//            var avatar = $('input[name="avatar_data"]').val();
//            // if (avatar == '') {
//            //     toastError('请先选择图片');
//            //     return false;
//            // }
//            var formData = new FormData($('.cover-form')[0]);
////            var formData = $('.cover-form').serialize();
//            $.ajax({
//                data: formData,
//                type: 'POST',
//                dataType: 'json',
//                async: false,
//                cache: false,
//                contentType: false,
//                processData: false,
//                url: __root__ + '/Admin/Image/ajaxSaveArticleCover',
//                success: function (data) {
//                    if (data['status'] == 0) {
//                        $('input[name="img_url"]').val(data.data.save_path);
//                        $('.info-cover').attr('src', data.data.show_path);
//                        $('#doc-modal-1').modal('close');
//                    } else {
//                        alert_modal(data.msg);
//                    }
//                },
//                error: function (data) {
//                    alert_modal('网络异常,请稍候重试');
//                }
//
//
//            })
//        });
//
//        $("#4").on("change", function () {
//            $("#qt_second_tags").toggle();
//        });
//
//        $("#15").on("change", function () {
//            $("#shyk_second_tags").toggle();
//            if($('#15').is(':checked')) {
//                $('#meeting_at').show();
//            }else if($('#15').is(':checked') == false && $('#16').is(':checked') == false && $('#17').is(':checked') == false){
//                $('#meeting_at').hide();
//            }
//        });
//
//        $("#16").on("change", function () {
//            if($('#16').is(':checked')) {
//                $('#meeting_at').show();
//            }else if($('#15').is(':checked') == false && $('#16').is(':checked') == false && $('#17').is(':checked') == false){
//                $('#meeting_at').hide();
//            }
//        });
//
//        $("#17").on("change", function () {
//            $("#mzshh_second_tags").toggle();
//            if($('#17').is(':checked')) {
//                $('#meeting_at').show();
//            }else if($('#15').is(':checked') == false && $('#16').is(':checked') == false && $('#17').is(':checked') == false){
//                $('#meeting_at').hide();
//            }
//        });

        // $(".article_tag").change(function() {
        //  alert("checked");
        //  });

        $('#datetimepicker').datetimepicker({
            format: 'yyyy-mm-dd hh:ii',
            language:  'zh-CN'
        });
    </script>



    <script>
        $('#btn-cancel').click(function () {
            $('#confirm-text').text('确认取消编辑吗?');
            $('#my-confirm').modal({
                relatedTarget: this,
                onConfirm: function (options) {
                    javascript :history.back(1);
                },
                onCancel: function () {

                }
            });
        });

        $(".classify").change(function() {
            var classify = $('input[name="classify"]:checked').val();
            if(classify == 1){
                $("#div-attendance").show();
            }else{
                $("#div-attendance").hide();
            }
        });

    </script>
</block>
