<!--<!doctype html>
<html class="no-js">--><!DOCTYPE html>
<html lang="en">
 <head> 
  <meta charset="utf-8" /> 
  <meta name="description" content="" /> 
  <meta name="keywords" content="" /> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
  <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width" /> 
  <title>{$webTitle}</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /> 
  <meta http-equiv="pragma" content="no-cache" /> 
  <meta http-equiv="cache-control" content="no-cache" /> 
  <meta http-equiv="expires" content="0" /> 
  <meta name="flexible" content="initial-dpr=2" /> 
  <!-- Add to homescreen for Chrome on Android --> 
  <meta name="mobile-web-app-capable" content="yes" /> 
  <link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png" /> 
  <!-- Add to homescreen for Safari on iOS --> 
  <meta name="apple-mobile-web-app-capable" content="yes" /> 
  <meta name="apple-mobile-web-app-status-bar-style" content="black" /> 
  <meta name="apple-mobile-web-app-title" content="Amaze UI" /> 
  <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png" /> 
  <!-- Tile icon for Win8 (144x144 + tile color) --> 
  <meta name="msapplication-TileImage" content="assets/i/app-icon72x72@2x.png" /> 
  <meta name="msapplication-TileColor" content="#0e90d2" /> 
  <link rel="stylesheet" href="__STATICS__/swiper/css/swiper-3.4.2.min.css" /> 
  <!-- <link rel="stylesheet" href="__STATICS__/webuploader-0.1.5/webuploader.css" />  -->
  <!-- <link rel="stylesheet" href="__STATICS__/swiper/css/animate.min 15.39.06.css"> --> 
  <style>
        html, body {
        position: relative;
        height: 100%;
        
        
    }
    body {
        font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
        font-size: 14px;
        color:#000;
        padding: 0;
        margin: 0px auto;
        max-width: 640px !important;
    }
    .swiper-container {
        width: 100%;
        height: 100%;
         background: url("__IMG__/mb/mb1/bg.png") no-repeat;
        background-size: cover;

    }

    .swiper-slide {
        text-align: center;
        /*font-size: 18px;*/
        

    }
    .slide_title{
    	font-size: 20px;
        color: #fff;
        margin-top: 22%;
    }
    .slide_hr{
        padding-top: 0px;
    	height:2px;
    	width:30px;
    	border:none;
    	border-top:3px solid #fff;
    }
    .slide1_content{
    	width: 100%;
    }
    .slide_content_img_div{
    	color: #fff;
    }
    .slide_content_img_div img{
    	border:3px solid #fff;
    	width: 70% !important;
    	margin-top: 20px;
    	
    }

   .btn-next{
   	        background:transparent;
			width: 150px;
			height: 40px;
			line-height: 40px;
			text-align: center;
			margin: 50px auto 0px auto;
			border-radius: 30px;
			background: rgba(255,255,255,0.3);
			font-size: 18px;
			color: #fff;
		}
    .slide_content2{
    	width: 90%;
    	margin: 25% 5% 10% 5%;
    	position: relative;
    }
    .slide_content2 img{
        max-width: 100% !important;
        z-index: -1;
    }
    .slide_content2_div{
        position: absolute;
        top: 20%;
        left: 10%;
        width: 80%;
    }
    .slide_content2_div h1{
    	color: #fff;
    	margin-bottom: 1.3em;
    }
    .slide_content2_div p{
    	color: #fff;
    	font-size: 16px;
    }
    .copy_img{
    	position: absolute;
        top: 20px;
        right: 20px;
        width: 50px;
    }
    .delete_img{
    	position: absolute;
        top: 80px;
        right: 20px;
        width: 50px;
    }


    .add_shade{
    position: absolute;
    z-index: 102;
    top: 0;
    left: 0;
    background: url("__IMG__/leave/bg.png") no-repeat;
    background-size: cover;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
}
.add_shade>.container{
    width:80%;
    /*height:4rem;*/
    background-color: #ffffff;
    margin:45% auto;
    border-radius: 5px;
    padding-top:0.3rem;
    overflow: hidden;
    text-align: center;

}
.add_shade>.container>.inp{
    border-bottom: 1px solid #999999;
    padding:0.4rem 0 0 0.3rem;
    height:1rem;
}
.add_shade>.container>.inp>input{
    vertical-align: bottom;
    border: none;
    color:#666666;
    font-size: 14px;
}
.add_shade>.container>.btn{
    margin-top:1.4rem;
    margin-bottom:1.4rem;
    width: 40%;
    height:1rem;
    line-height: 1rem;
    float: right;
    color:#666666;
}
.add_shade>.container>.btn>.ensure{
    float: right;
    margin-right: 1.2rem;
    color:#ce3d3a;
}
.hide{
    display: none;
}
.show{
    display: inline-block;
}
.next-page{
	left: 48%;
    bottom: 15px;
    width: 35px;
    position: absolute;

}

 .add_img_shade{
    position: absolute;
    z-index: 102;
    top: 0;
    left: 0;
    background: url("__IMG__/leave/bg.png") no-repeat;
    background-size: cover;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
}
.add_img_shade>.container{
    width:80%;
    /*height:4rem;*/
    background-color: #ffffff;
    margin:45% auto;
    border-radius: 5px;
    padding-top:0.3rem;
    overflow: hidden;
    text-align: center;

}
.add_img_shade>.container>.btn{
    margin-top:1.4rem;
    margin-bottom:1.4rem;
    width: 40%;
    height:1rem;
    line-height: 1rem;
    float: right;
    color:#666666;
}
.add_img_shade>.container>.btn>.img_ensure{
    float: right;
    margin-right: 1.2rem;
    color:#ce3d3a;
}
/*.webuploader-container{
	position: relative;
}*/

    </style> 
 </head> 
 <body> 
  <div class="swiper-container"> 
   <div class="swiper-wrapper"> 
    <div class="swiper-slide"> 
     <p class="slide_title " >录入说明</p> 
     <hr class="slide_hr " /> 
     <div class="slide_content1"> 
      <div class="slide_content_img_div"> 
       <h3>请点击图片或文字修改台账内容</h3> 
      </div> 
      <div class="btn-next " onclick="next_slide();">
       开始录入台账
      </div>
      <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png"> 
     </div> 
    </div> 
    <div class="swiper-slide"> 
     <div class="slide_content2"> 
      <img src="__IMG__/mb/mb1/logo.png" /> 
      <div class="slide_content2_div"> 
       <h1 onclick="changText(this);" id="tz_title">【{$now|date="Y-m",###}】标题</h1> 
       <p><span onclick="changText(this);" id="tz_party">{$user['branch_name']?$user['branch_name']:'机关党委办公室'}</span>
           &nbsp;&nbsp;&nbsp;<span onclick="changText(this);" id="tz_name">{$user['realname']?$user['realname']:'张三'}</span>
       </p>
       <p onclick="changText(this);" id="tz_time">{$now|date="Y-m-d",###}</p> 
       <p onclick="changText(this);" id="tz_address">珠海妇幼保健院</p> 

      </div> 
      <div class="btn-next" onclick="next_slide();">
       下一步
      </div> 
     </div> 
     <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png"> 
    </div>
       <!--领导指示-->
    <div class="swiper-slide tz_content"> 
     <p class="slide_title">领导指示</p> 
     <hr class="slide_hr " /> 
     <img class="copy_img " onclick="copy_slide(this,1);" src="__IMG__/mb/mb1/copy.png" /> 
     <img class="delete_img " onclick="delete_slide(this);" src="__IMG__/mb/mb1/delete.png" /> 
     <div class="slide_content3"> 
      <div class="slide_content_img_div"> 
            <img class="image" onclick="change_img(this);"  src="__IMG__/mb/mb1/b.png"   alt=""/> 
       <p class="content" onclick="changText(this);">请在这里录入领导指示的内容。</p> 
       <input type="hidden" class="type" value="1"> 
      </div> 
      <div class="btn-next" onclick="next_slide();">
       下一步
      </div> 
     </div> 
     <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png"> 
    </div>
       <!--亮点-->
    <div class="swiper-slide tz_content"> 
     <p class="slide_title">亮点</p> 
     <hr class="slide_hr" /> 
     <img class="copy_img" onclick="copy_slide(this,2);" src="__IMG__/mb/mb1/copy.png" /> 
     <img class="delete_img " onclick="delete_slide(this);" src="__IMG__/mb/mb1/delete.png" /> 
     <div class="slide_content3"> 
      <div class="slide_content_img_div"> 
       <img  class="image" onclick="change_img(this);" src="__IMG__/mb/mb1/c.png" alt=""/> 
       <p class="title" style="font-size:18px;" onclick="changText(this);">亮点标题</p> 
       <p class="content" onclick="changText(this);">请在这里录入亮点的内容。</p> 
       <input type="hidden" class="type" value="2">
      </div> 
      <div class="btn-next" onclick="next_slide();">
       下一步
      </div> 
     </div> 
     <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png"> 
    </div>
       <!--活动内容-->
    <div class="swiper-slide tz_content"> 
     <p class="slide_title">活动内容</p> 
     <hr class="slide_hr" /> 
     <img class="copy_img" onclick="copy_slide(this,3);" src="__IMG__/mb/mb1/copy.png" /> 
     <img class="delete_img " onclick="delete_slide(this);" src="__IMG__/mb/mb1/delete.png" /> 
     <div class="slide_content3"> 
      <div class="slide_content_img_div"> 
       <img class="image" onclick="change_img(this);" src="__IMG__/mb/mb1/c.png" alt=""/> 
       <p class="title" style="font-size:18px;" onclick="changText(this);">活动标题</p> 
       <p class="content" onclick="changText(this);">请在这里录入活动的内容。</p>
       <input type="hidden" class="type" value="3"> 
      </div> 
      <div class="btn-next" onclick="next_slide();">
       下一步
      </div> 
     </div> 
     <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png"> 
    </div> 
    <div class="swiper-slide"> 
     <p class="slide_title">保存台账</p> 
     <hr class="slide_hr" /> 
     <div class="slide_content3"> 
      <div class="slide_content_img_div"> 
       <p onclick="changText(this);">如果您的台账已录入完成，请点击提交</p> 
      </div> 
      <div class="btn-next" onclick="submit_taizhang();">
       提交
      </div> 
     </div> 
    </div> 

   </div> 

   <div class="swiper-scrollbar"></div> 
  </div> 
  <div class="add_shade hide">
   <!--添加class名hide隐藏弹框--> 
   <div class="container"> 
    <p style="color:#999;">请修改输入框的内容</p> 
    <textarea id="change_textarea" rows="5" style="width:90%;"></textarea> 
    <div class="btn"> 
     <a class="cancel">取消</a> 
     <a class="ensure">确定</a> 
    </div> 
   </div> 
  </div> 

  <div style="display: none">
      <!--可以选择的内容复制-->
   <div id="slider_zs"> 
    <div class="swiper-slide tz_content"> 
     <p class="slide_title">领导指示</p> 
     <hr class="slide_hr" /> 
     <img class="copy_img" onclick="copy_slide(this,1);" src="__IMG__/mb/mb1/copy.png" /> 
     <img class="delete_img " onclick="delete_slide(this);" src="__IMG__/mb/mb1/delete.png" /> 
     <div class="slide_content3"> 
      <div class="slide_content_img_div"> 
       <img class="image" onclick="change_img(this);" src="__IMG__/mb/mb1/b.png" alt=""/> 
       <p class="content" onclick="changText(this);">请在这里录入领导指示的内容。</p>
       <input type="hidden" class="type" value="1"> 
      </div> 
      <div class="btn-next" onclick="next_slide();">
       下一步
      </div> 
     </div>
     <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png">  
    </div> 
   </div> 
   <div id="slider_ld"> 
    <div class="swiper-slide tz_content"> 
     <p class="slide_title">亮点</p> 
     <hr class="slide_hr" /> 
     <img class="copy_img" onclick="copy_slide(this,2);" src="__IMG__/mb/mb1/copy.png" /> 
     <img class="delete_img " onclick="delete_slide(this);" src="__IMG__/mb/mb1/delete.png" /> 
     <div class="slide_content3"> 
      <div class="slide_content_img_div"> 
       <img class="image" onclick="change_img(this);"  src="__IMG__/mb/mb1/c.png" alt=""/> 
       <p class="title" style="font-size:18px;" onclick="changText(this);">亮点标题</p> 
       <p class="content" onclick="changText(this);">请在这里录入两点的内容。</p> 
       <input type="hidden" class="type" value="2">
      </div> 
      <div class="btn-next" onclick="next_slide();">
       下一步
      </div> 
     </div> 
     <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png"> 
    </div> 
   </div> 
   <div id="slider_nr"> 
    <div class="swiper-slide tz_content"> 
     <p class="slide_title">内容</p> 
     <hr class="slide_hr" /> 
     <img class="copy_img" onclick="copy_slide(this,3);" src="__IMG__/mb/mb1/copy.png" /> 
     <img class="delete_img " onclick="delete_slide(this);" src="__IMG__/mb/mb1/delete.png" /> 
     <div class="slide_content3"> 
      <div class="slide_content_img_div"> 
       <img class="image" onclick="change_img(this);" src="__IMG__/mb/mb1/c.png" alt=""/> 
       <p class="title" onclick="changText(this);" style="font-size:18px;">内容标题</p> 
       <p class="content" onclick="changText(this);">请在这里录入内容。</p> 
       <input type="hidden" class="type" value="3">
      </div> 
      <div class="btn-next" onclick="next_slide();">
       下一步
      </div> 
     </div> 
     <img class="next-page" onclick='next_slide();' src="__IMG__/mb/mb1/jiantou.png"> 

    </div> 
   </div> 
  </div> 
  <div id="picker"></div>
  <include file="Common/_loading"/>
  <script>var __root__ = "__ROOT__";</script> 
  <script src="__STATICS__/assets/js/jquery.min.js"></script> 
  <script src="__STATICS__/swiper/js/swiper-3.4.2.jquery.min.js"></script> 
  <!-- <script src="__STATICS__/swiper/js/swiper.animate1.0.2.min.js"></script> --> 
  
  <script type="text/javascript" src="__STATICS__/webuploader-0.1.5/webuploader.min.js"></script>
  <script>
		var img_obj;
		var uploader = WebUploader.create({
			// swf文件路径
			swf: '__STATICS__/webuploader-0.1.5/Uploader.swf',
			// 文件接收服务端。
			//后台接口
			//                        server: '__ROOT__/Admin/File/upload',
			//前端接口
			server: '__ROOT__/Mob/Taizhang/ajaxUploadCover',
			// 选择文件的按钮。可选。
			// 内部根据当前运行是创建，可能是input元素，也可能是flash.
			pick: {
				id: '#picker',
				//只能选择一个文件上传
				multiple: false
			},
			auto: true,
			// 开起分片上传。
			chunked: true,
			chunkSize: 2 * 1024 * 1024,
			// 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
			resize: false,
			// 禁掉全局的拖拽功能。这样不会出现图片拖进页面的时候，把图片打开。
			disableGlobalDnd: true,
			fileNumLimit: 1,
			fileSizeLimit: 400 * 1024 * 1024,
			// 550 M
			fileSingleSizeLimit: 128 * 1024 * 1024,
			// 55 M
			accept: {
				title: 'image',
				extensions: 'png,jpg,jpeg,gif,bmp,PNG,JPG,JPEG,GIF,BMP',
				mimeTypes: ''
			},
		});
		// 当有文件被添加进队列的时候
		uploader.on('fileQueued', function(file) {
			console.log("fileQueued");
			loading("正在上传");
		});
		// 文件上传过程中创建进度条实时显示。
		uploader.on('uploadProgress', function(file, percentage) {
			loading(percentage.toFixed(2) * 100 + "%")
			console.log("percentage = " + percentage * 100 + "%");
			//                      $("#loading-text").text("正在上传"+percentage.toFixed(2) * 100 + "%");

		});

		var fileItem = $('.file-item').html();
		uploader.on('uploadSuccess', function(file, response) {

			console.log("success" + JSON.stringify(response));
			// $("#mytest").append("<p>成功"+JSON.stringify(response)+"</p>");
			if(response.status == 0) {
				close_loading();
				//插入文件
                $(img_obj).attr('src',response["data"]["show_path"]);
                $(img_obj).attr('alt',response["data"]["save_path"]);
			} else {
				$("#loading-text").text("上传失败");
				close_loading();
				alert(response.msg);
			}

		});
		$('.file-div').on('click','.file-close',function(){
			$(this).parent().remove();
			return false;
		})

		uploader.on('uploadError', function(file) {
			closeUploader(uploader);
			console.log("uploadError");
			alert("上传失败，请上传png,jpg,jpeg,gif,bmp格式的照片");

		});

		uploader.on('uploadComplete', function(file) {
			console.log("uploadComplete");
			closeUploader(uploader);

		});
		uploader.on('uploadAccept', function(file, response) {
			console.log("uploadAccept" + JSON.stringify(response));
		});

		function closeUploader(uploader) {
			// 移除所有缩略图并将上传文件移出上传序列
			for(var i = 0; i < uploader.getFiles().length; i++) {
				// 将图片从上传序列移除
				uploader.removeFile(uploader.getFiles()[i]);
			}

			// 重置uploader，目前只重置了文件队列
			uploader.reset();
			// 更新状态等，重新计算文件总个数和总大小
		}

		function change_img(obj){
		   img_obj = obj;
    	   return $("#picker input[name='file']").click();
        }
	</script>



  <script type="text/javascript">
    var click_obj;
    var tag_id = {$tag_id};

    var norm_id = {$norm_id};
    var spec_id = {$spec_id};
    var type = {$type};
    var temp_id = {$temp_id};
    var notice_id = {$notice_id};
    // $(document).ready(function () {
    var mySwiper = new Swiper ('.swiper-container', {
    direction: 'vertical',
    observer:true,
    observeParents:true,
    loop: true,
    // effect : 'cube',
    
    // 如果需要分页器
    // pagination: '.swiper-pagination',
    
    // 如果需要前进后退按钮
    // nextButton: '.swiper-button-next',
    // prevButton: '.swiper-button-prev',
    
    // 如果需要滚动条
    // scrollbar: '.swiper-scrollbar',
  //   onInit: function(mySwiper){ //Swiper2.x的初始化是onFirstInit
  //   swiperAnimateCache(mySwiper); //隐藏动画元素 
  //   swiperAnimate(mySwiper); //初始化完成开始动画
  // }, 
  //   onSlideChangeEnd: function(mySwiper){ 
  //   swiperAnimate(mySwiper); //每个slide切换结束时也运行当前slide动画
  // } 
  })
  $('.copy1').click(function(){
  	var templateHtml = $('#slider_zs').html();
  	$(this).parent().after(templateHtml); 
    mySwiper.slideNext(null,1000);
   })

  function copy_slide(obj,type){
  	if (type == 1) {
  		var templateHtml = $('#slider_zs').html();
  	}else if (type == 2) {
  		var templateHtml = $('#slider_ld').html();
  	}else{
  		var templateHtml = $('#slider_nr').html();
  	};
     $(obj).parent().after(templateHtml); 
     mySwiper.update();
     mySwiper.slideNext(null,1000);
  }
  function next_slide(){
    	mySwiper.slideNext(null,1000);
    }
  function delete_slide(obj){
    $(obj).parent().remove();
  }

  

   // })

   function changText(obj){
   	var text = $(obj).text();
   	$("#change_textarea").val(text);
    $(".add_shade").removeClass("hide");
    $(".add_shade").addClass("show");
    click_obj = obj;
   }

   $(".add_shade .ensure").click(function(){
   	   $(".add_shade").removeClass("show");
       $(".add_shade").addClass("hide");
       $(click_obj).text($("#change_textarea").val());
    });
   $(".add_shade .cancel").click(function(){
   	  $(".add_shade").removeClass("show");
       $(".add_shade").addClass("hide");
       $("#change_textarea").val("");
    });

   function submit_taizhang(){
      var tz = {};
      var contents = [];
      var content = {};
      tz["title"] = $("#tz_title").text();//标题
      tz["party"] = $("#tz_party").text();//所在支部
      tz["name"] = $("#tz_name").text();//录入人姓名
      tz["time"] = $("#tz_time").text();
      tz["address"] = $("#tz_address").text();//地址（固定）
      tz["tag_id"] = tag_id;
      tz["norm_id"] = norm_id;
      tz["spec_id"] = spec_id;
      tz["type"] = type;
      tz["temp_id"] = temp_id;
      tz["notice_id"] = notice_id;
      $(".swiper-wrapper").find(".tz_content").each(function(){
      	content["title"] = $(this).find(".title").text();
      	content["content"] = $(this).find(".content").text();
      	content["image"] = $(this).find(".image").attr("alt");
      	content["type"] = $(this).find(".type").val();
      	contents.push(content);
      	content = {};
      })
      $.ajax({
                    url: '__ROOT__/Mob/Taizhang/ajaxadd',
                    type: 'POST',
                    data: {"tz":tz,"contents":contents},
                    dataType: 'json',
                    success: function (data) {
                        $(location).attr('href', '__ROOT__/Mob/Taizhang/show?id='+data['msg']);
                    },
                    error: function (data) {
                        alert("台账发布失败");
                    }
                })
   }

   function changImg(obj){
      $(".add_img_shade").removeClass("hide");
      $(".add_img_shade").addClass("show");
      click_obj = obj;
   }
    $(".add_img_shade .img_ensure").click(function(){
   	   $(".add_img_shade").removeClass("show");
       $(".add_img_shade").addClass("hide");
    });
   $(".add_img_shade .img_cancel").click(function(){
   	  $(".add_img_shade").removeClass("show");
       $(".add_img_shade").addClass("hide");
    });

    

</script> 
  <script>
    function get_head_url(url){
        if (url == '' || url == null || url == undefined ) {
            return   '__ROOT__/Public/Common/img/common-head.png';
        } else if(url.indexOf('http:')>-1 || url.indexOf('https:')>-1){
            return url;
        } else if(url.indexOf('/Uploads')>-1) {
            return　'__ROOT__' +　url;
        }else{
            return   '__ROOT__/Uploads/' +　url;
        }
    }

</script>   
 </body>
</html>

